services:
  go-root:
    build:
      context: ./
      dockerfile: ./Dockerfile
    image: go-root:latest
    container_name: go-root
    restart: unless-stopped
    # env_file: ./.env  # Uncomment if .env file exists
    networks:
      - appnet
    ports:
      - "2343:2343" # Changed from 2342 to avoid conflict with PhotoPrism
    expose:
      - "2343"  # Exposed by Go app in Dockerfile

  python-legal_brain:
    build:
      context: ./Legal_brain
      dockerfile: ./Legal_brainDockerfile
    image: python-legal_brain:latest
    container_name: python-legal_brain
    restart: unless-stopped
    ports:
      - "5001:8000" # Map host port 5001 to container port 8000
    environment:
      - PHOTOPRISM_API_URL=http://photoprism:2342/api/v1
      - PHOTOPRISM_ADMIN_PASSWORD=CheSey2024$ # Or your desired password
      - WHISPER_API_URL=http://host.docker.internal:9000/asr # Assuming Whisper runs on host
      - ORIGINALS_MOUNT_PATH=/photoprism/originals # Path inside this container
      - IMPORT_MOUNT_PATH=/photoprism/import       # Path inside this container
      - PROCESSED_DATA_PATH=/processed_data      # Path inside this container
    # env_file: ./Legal_brain/.env  # Uncomment if .env file exists
    networks:
      - appnet
    expose:
      - "8000"  # Exposed by Python app in Dockerfile
    volumes:
      - C:\Users\casey\LegalBrainData\photoprism_originals:/photoprism/originals
      - C:\Users\casey\LegalBrainData\photoprism_import:/photoprism/import
      - C:\Users\casey\LegalBrainData\processed:/processed_data
    depends_on:
      - photoprism

  js-frontend:
    build:
      context: ./frontend
      dockerfile: ../frontendDockerfile
    image: js-frontend:latest
    container_name: js-frontend
    restart: unless-stopped
    init: true
    # env_file: ./frontend/.env  # Uncomment if .env file exists
    networks:
      - appnet
    ports:
      - "3000:3000"
    expose:
      - "3000"  # Exposed by frontend app in Dockerfile

  ts-electron-react-app:
    build:
      context: ./electron-react-app
      dockerfile: ../electron-react-appDockerfile
    image: ts-electron-react-app:latest
    container_name: ts-electron-react-app
    restart: unless-stopped
    init: true
    # env_file: ./electron-react-app/.env  # Uncomment if .env file exists
    networks:
      - appnet

  photoprism:
    image: photoprism/photoprism:latest
    container_name: photoprism
    restart: unless-stopped
    ports:
      - "2342:2342" # Host port:Container port
    networks:
      - appnet
    environment:
      - PHOTOPRISM_ADMIN_PASSWORD=CheSey2024$ # IMPORTANT: Change this to a strong, unique password!
      - PHOTOPRISM_ORIGINALS_LIMIT= # Optional: Set a limit for originals size, e.g., 500000 for 500GB
      - PHOTOPRISM_HTTP_HOST=0.0.0.0
      - PHOTOPRISM_HTTP_PORT=2342
      - PHOTOPRISM_SITE_URL=http://localhost:2342/
      # Database settings - will connect to the mariadb service below
      - PHOTOPRISM_DATABASE_DRIVER=mysql
      - PHOTOPRISM_DATABASE_SERVER=mariadb:3306 # Use service name 'mariadb'
      - PHOTOPRISM_DATABASE_NAME=photoprism
      - PHOTOPRISM_DATABASE_USER=photoprism
      - PHOTOPRISM_DATABASE_PASSWORD=photoprism_db_password # IMPORTANT: Change this for MariaDB
    volumes:
      - C:\Users\casey\LegalBrainData\photoprism_originals:/photoprism/originals # Original media files (read-only recommended after initial scan)
      - C:\Users\casey\LegalBrainData\photoprism_storage:/photoprism/storage     # Database, sidecar files, cache, and thumbnails
      - C:\Users\casey\LegalBrainData\photoprism_import:/photoprism/import       # Import folder
    depends_on:
      - mariadb

  mariadb:
    image: mariadb:latest # Use the latest official MariaDB image
    container_name: mariadb
    restart: unless-stopped
    networks:
      - appnet
    environment:
      - MARIADB_AUTO_UPGRADE=1
      - MYSQL_ROOT_PASSWORD=mariadb_root_secret # IMPORTANT: Change this to a strong, unique password!
      - MYSQL_DATABASE=photoprism
      - MYSQL_USER=photoprism
      - MYSQL_PASSWORD=photoprism_db_password # Use the same password as in photoprism service db settings
    volumes:
      - C:\Users\casey\LegalBrainData\photoprism_db:/var/lib/mysql # Persist database files

networks:
  appnet:
    driver: bridge
