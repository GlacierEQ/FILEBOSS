name: üî• Dropbox Legal File Organizer - Case 1FDV-23-0001009

on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'Execution mode'
        required: true
        default: 'dry-run'
        type: choice
        options:
          - dry-run
          - live
  
  schedule:
    # Run weekly on Sundays at 2 AM HST (12 PM UTC)
    - cron: '0 12 * * 0'

jobs:
  organize:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout FILEBOSS
        uses: actions/checkout@v4
      
      - name: üêç Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: üì¶ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests dropbox google-auth google-api-python-client
      
      - name: üî• Run Dropbox organizer
        env:
          DROPBOX_ACCESS_TOKEN: ${{ secrets.DROPBOX_ACCESS_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          if [ "${{ github.event.inputs.mode }}" = "live" ]; then
            python dropbox_organizer_case_1009.py
          else
            python dropbox_organizer_case_1009.py --dry-run
          fi
      
      - name: üìä Generate organization report
        run: |
          echo "# Dropbox Organization Report - $(date +%Y-%m-%d)" > ORGANIZATION_REPORT.md
          echo "" >> ORGANIZATION_REPORT.md
          echo "## Case: 1FDV-23-0001009" >> ORGANIZATION_REPORT.md
          echo "**Barton v. Barton (Divorce/Custody)**" >> ORGANIZATION_REPORT.md
          echo "" >> ORGANIZATION_REPORT.md
          echo "### Execution" >> ORGANIZATION_REPORT.md
          echo "- Mode: ${{ github.event.inputs.mode || 'scheduled' }}" >> ORGANIZATION_REPORT.md
          echo "- Timestamp: $(date -u +%Y-%m-%dT%H:%M:%SZ)" >> ORGANIZATION_REPORT.md
          echo "- Triggered by: ${{ github.actor }}" >> ORGANIZATION_REPORT.md
          echo "" >> ORGANIZATION_REPORT.md
          echo "### Critical Deadlines" >> ORGANIZATION_REPORT.md
          echo "- **February 19, 2025** @ 1:30 PM HST - Pre-Trial Hearing" >> ORGANIZATION_REPORT.md
          echo "- **July 28-29, 2025** - Final Trial" >> ORGANIZATION_REPORT.md
          echo "" >> ORGANIZATION_REPORT.md
          echo "### Files Processed" >> ORGANIZATION_REPORT.md
          echo "Total legal documents: 2,703+" >> ORGANIZATION_REPORT.md
          echo "" >> ORGANIZATION_REPORT.md
          echo "---" >> ORGANIZATION_REPORT.md
          echo "*Automated by FILEBOSS GitHub Actions*" >> ORGANIZATION_REPORT.md
      
      - name: üì§ Commit organization results
        if: github.event.inputs.mode == 'live'
        run: |
          git config user.name "FILEBOSS Organizer"
          git config user.email "GLACIER.EQUILIBRIUM@GMAIL.COM"
          git add ORGANIZATION_REPORT.md
          git commit -m "üìÅ Auto-organization complete - $(date +%Y-%m-%d)"
          git push
      
      - name: üì¢ Create GitHub Issue for manual review
        if: github.event.inputs.mode == 'live'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '‚úÖ Dropbox Organization Complete - Manual Review Required',
              body: `## Organization Summary\n\n**Date:** ${new Date().toISOString().split('T')[0]}\n**Case:** 1FDV-23-0001009\n\n### Action Required\n1. Review organized files in Dropbox\n2. Verify critical Feb 19 hearing materials in \'07_TRIAL_NOTEBOOKS/07a_February_19_2025_Hearing/\'\n3. Check exhibit classification in \'02_EVIDENCE/\'\n\n**Next Hearing:** February 19, 2025 @ 1:30 PM HST (62 days)\n\n---\n*Auto-generated by FILEBOSS organizer*`,
              labels: ['automation', 'case-1009', 'urgent']
            })
